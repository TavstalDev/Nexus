plugins {
    java
    id("org.jetbrains.gradle.plugin.idea-ext") version "1.1.8"
    id("xyz.jpenilla.run-velocity") version "2.3.1"
    id("net.kyori.blossom") version "2.1.0"
}

val javaVersion: String by project
val velocityVer: String by project
val configurateVersion: String by project
val mineCoreLibVersion: String by project
val projectPackageName = "${project.group}.nexus"

// Configure Java toolchain and compatibility settings
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(javaVersion)
        sourceCompatibility = JavaVersion.toVersion(javaVersion)
        targetCompatibility = JavaVersion.toVersion(javaVersion)
    }
}

repositories {
    mavenCentral() // Central Maven repository
    maven {
        name = "papermc"
        url = uri("https://repo.papermc.io/repository/maven-public/")
    }
    maven {
        url = uri("https://jitpack.io") // JitPack repository
    }
    maven {
        name = "sponge"
        url = uri("https://repo.spongepowered.org/maven/")
    }
}

dependencies {
    compileOnly("com.velocitypowered:velocity-api:${velocityVer}")
    annotationProcessor("com.velocitypowered:velocity-api:${velocityVer}")

    // Core Configurate API
    implementation("org.spongepowered:configurate-core:${configurateVersion}")
    // YAML Format Support
    implementation("org.spongepowered:configurate-yaml:${configurateVersion}")
}

tasks {
    compileJava {
        options.encoding = Charsets.UTF_8.name()
        options.release.set(21)
    }
    clean {
        // Deletes the directory that is generated by the runVelocity plugin
        delete("run")
    }
    runVelocity {
        velocityVersion(velocityVer)
    }
    jar {
        archiveBaseName.set("nexusProxy")
        archiveClassifier.set("")
    }
}

sourceSets {
    main {
        blossom {
            javaSources {
                property("version", project.version.toString())
            }
        }
    }
}